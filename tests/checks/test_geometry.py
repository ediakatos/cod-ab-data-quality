import pytest
from geopandas import GeoDataFrame

from src.checks.geometry_valid import main


@pytest.mark.slow
def test_mdg_geometry(iso3: str, gdfs: list[GeoDataFrame]) -> None:
    actual = main(iso3, gdfs)
    expected = [
        {
            "iso3": "MDG",
            "level": 0,
            "geom_count": 1,
            "geom_empty": 0,
            "geom_not_polygon": 0,
            "geom_has_z": 0,
            "geom_invalid": 0,
            "geom_invalid_reason": "",
            "geom_proj": 4326,
            "geom_min_x": 43.176924,
            "geom_min_y": -25.605753,
            "geom_max_x": 50.484852,
            "geom_max_y": -11.951388,
            "geom_area_km": 592192.582884,
        },
        {
            "iso3": "MDG",
            "level": 1,
            "geom_count": 22,
            "geom_empty": 0,
            "geom_not_polygon": 0,
            "geom_has_z": 0,
            "geom_invalid": 0,
            "geom_invalid_reason": "",
            "geom_proj": 4326,
            "geom_min_x": 43.176924,
            "geom_min_y": -25.605753,
            "geom_max_x": 50.484852,
            "geom_max_y": -11.951388,
            "geom_area_km": 592192.582884,
        },
        {
            "iso3": "MDG",
            "level": 2,
            "geom_count": 119,
            "geom_empty": 0,
            "geom_not_polygon": 0,
            "geom_has_z": 0,
            "geom_invalid": 0,
            "geom_invalid_reason": "",
            "geom_proj": 4326,
            "geom_min_x": 43.176924,
            "geom_min_y": -25.605753,
            "geom_max_x": 50.484852,
            "geom_max_y": -11.951388,
            "geom_area_km": 592192.582884,
        },
        {
            "iso3": "MDG",
            "level": 3,
            "geom_count": 1579,
            "geom_empty": 0,
            "geom_not_polygon": 0,
            "geom_has_z": 0,
            "geom_invalid": 0,
            "geom_invalid_reason": "",
            "geom_proj": 4326,
            "geom_min_x": 43.176924,
            "geom_min_y": -25.605753,
            "geom_max_x": 50.484852,
            "geom_max_y": -11.951388,
            "geom_area_km": 592192.582884,
        },
        {
            "iso3": "MDG",
            "level": 4,
            "geom_count": 17465,
            "geom_empty": 0,
            "geom_not_polygon": 0,
            "geom_has_z": 0,
            "geom_invalid": 2,
            "geom_invalid_reason": "Ring Self-intersection",
            "geom_proj": 4326,
            "geom_min_x": 43.176924,
            "geom_min_y": -25.605753,
            "geom_max_x": 50.484852,
            "geom_max_y": -11.951388,
            "geom_area_km": 592192.582884,
        },
    ]
    assert actual == expected
